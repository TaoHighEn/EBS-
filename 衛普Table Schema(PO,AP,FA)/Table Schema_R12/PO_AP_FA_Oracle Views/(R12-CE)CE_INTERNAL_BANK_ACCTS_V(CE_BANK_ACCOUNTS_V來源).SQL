DROP VIEW APPS.CE_INTERNAL_BANK_ACCTS_V;

/* Formatted on 2013/11/18 10:35 (Formatter Plus v4.8.8) */
CREATE OR REPLACE FORCE VIEW apps.ce_internal_bank_accts_v (bank_account_id,
                                                            bank_account_name,
                                                            last_update_date,
                                                            last_updated_by,
                                                            last_update_login,
                                                            creation_date,
                                                            created_by,
                                                            bank_account_num,
                                                            bank_branch_id,
                                                            bank_id,
                                                            currency_code,
                                                            description,
                                                            attribute_category,
                                                            attribute1,
                                                            attribute2,
                                                            attribute3,
                                                            attribute4,
                                                            attribute5,
                                                            attribute6,
                                                            attribute7,
                                                            attribute8,
                                                            attribute9,
                                                            attribute10,
                                                            attribute11,
                                                            attribute12,
                                                            attribute13,
                                                            attribute14,
                                                            attribute15,
                                                            request_id,
                                                            program_application_id,
                                                            program_id,
                                                            program_update_date,
                                                            check_digits,
                                                            bank_account_name_alt,
                                                            account_holder_id,
                                                            eft_requester_identifier,
                                                            secondary_account_reference,
                                                            account_suffix,
                                                            description_code1,
                                                            description_code2,
                                                            iban_number,
                                                            short_account_name,
                                                            account_owner_party_id,
                                                            account_owner_org_id,
                                                            account_classification,
                                                            ap_use_allowed_flag,
                                                            ar_use_allowed_flag,
                                                            xtr_use_allowed_flag,
                                                            pay_use_allowed_flag,
                                                            multi_currency_allowed_flag,
                                                            payment_multi_currency_flag,
                                                            receipt_multi_currency_flag,
                                                            zero_amount_allowed,
                                                            max_outlay,
                                                            max_check_amount,
                                                            min_check_amount,
                                                            ap_amount_tolerance,
                                                            ar_amount_tolerance,
                                                            xtr_amount_tolerance,
                                                            pay_amount_tolerance,
                                                            ap_percent_tolerance,
                                                            ar_percent_tolerance,
                                                            xtr_percent_tolerance,
                                                            pay_percent_tolerance,
                                                            bank_account_type,
                                                            agency_location_code,
                                                            start_date,
                                                            end_date,
                                                            account_holder_name_alt,
                                                            cashflow_display_order,
                                                            account_holder_name,
                                                            masked_account_num,
                                                            masked_iban,
                                                            pooled_flag,
                                                            min_target_balance,
                                                            max_target_balance,
                                                            eft_user_num,
                                                            interest_schedule_id,
                                                            asset_code_combination_id,
                                                            netting_acct_flag
                                                           )
AS
   SELECT DISTINCT ba.bank_account_id, ba.bank_account_name,
                   ba.last_update_date, ba.last_updated_by,
                   ba.last_update_login, ba.creation_date, ba.created_by,
                   ba.bank_account_num, ba.bank_branch_id, ba.bank_id,
                   ba.currency_code, ba.description, ba.attribute_category,
                   ba.attribute1, ba.attribute2, ba.attribute3, ba.attribute4,
                   ba.attribute5, ba.attribute6, ba.attribute7, ba.attribute8,
                   ba.attribute9, ba.attribute10, ba.attribute11,
                   ba.attribute12, ba.attribute13, ba.attribute14,
                   ba.attribute15, ba.request_id, ba.program_application_id,
                   ba.program_id, ba.program_update_date, ba.check_digits,
                   ba.bank_account_name_alt, ba.account_holder_id,
                   ba.eft_requester_identifier,
                   ba.secondary_account_reference, ba.account_suffix,
                   ba.description_code1, ba.description_code2, ba.iban_number,
                   ba.short_account_name, ba.account_owner_party_id,
                   ba.account_owner_org_id, ba.account_classification,
                   ba.ap_use_allowed_flag, ba.ar_use_allowed_flag,
                   ba.xtr_use_allowed_flag, ba.pay_use_allowed_flag,
                   ba.multi_currency_allowed_flag,
                   ba.payment_multi_currency_flag,
                   ba.receipt_multi_currency_flag, ba.zero_amount_allowed,
                   ba.max_outlay, ba.max_check_amount, ba.min_check_amount,
                   ba.ap_amount_tolerance, ba.ar_amount_tolerance,
                   ba.xtr_amount_tolerance, ba.pay_amount_tolerance,
                   ba.ap_percent_tolerance, ba.ar_percent_tolerance,
                   ba.xtr_percent_tolerance, ba.pay_percent_tolerance,
                   ba.bank_account_type, ba.agency_location_code,
                   ba.start_date, ba.end_date, ba.account_holder_name_alt,
                   ba.cashflow_display_order, ba.account_holder_name,
                   ba.masked_account_num, ba.masked_iban, ba.pooled_flag,
                   ba.min_target_balance, ba.max_target_balance,
                   ba.eft_user_num, ba.interest_schedule_id,
                   ba.asset_code_combination_id, ba.netting_acct_flag
              FROM ce_bank_accounts ba, ce_bank_acct_uses_all bau
             WHERE ba.bank_account_id = bau.bank_account_id
               AND ba.account_classification = 'INTERNAL'
               AND EXISTS (
                      SELECT /*+ no_unnest */
                             1
                        FROM ce_security_profiles_v ou
                       WHERE (   (    bau.org_id = ou.organization_id
                                  AND ou.organization_type IN
                                         ('OPERATING_UNIT', 'BUSINESS_GROUP')
                                 )
                              OR (    bau.legal_entity_id = ou.organization_id
                                  AND ou.organization_type = 'LEGAL_ENTITY'
                                 )
                             ));

